<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DuoRacer - Corrida de Inglês</title>
    <!-- Tailwind CSS para utilitários de layout e estilo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

        :root {
            --duo-green: #58cc02;
            --duo-green-dark: #46a302;
            --duo-blue: #1cb0f6;
            --duo-red: #ff4b4b;
            --road-color: #555;
            --grass-color: #76c639;
        }

        body {
            font-family: 'Nunito', sans-serif;
            overflow: hidden;
            background-color: #111;
            touch-action: none;
            user-select: none;
        }

        /* Classes utilitárias personalizadas para o estilo "Flat/Duolingo" */
        .btn-flat {
            border-bottom-width: 4px;
            transition: all 0.1s;
            border-radius: 1rem;
        }
        .btn-flat:active {
            border-bottom-width: 0px;
            transform: translateY(4px);
        }

        /* Animação do fundo (Parallax simplificado) */
        .scrolling-bg {
            background-repeat: repeat-x;
            will-change: background-position;
        }

        /* Carro do Jogador */
        #player-car {
            transition: top 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
            filter: drop-shadow(0px 4px 4px rgba(0,0,0,0.5));
            z-index: 20;
        }

        /* Elementos da pista */
        .lane-text {
            text-shadow: 2px 2px 0px #000;
        }

        .obstacle {
            background-color: #1a1a1a;
            border-radius: 50%;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.8);
            border-bottom: 2px solid #333;
        }
        
        /* Velocímetro Customizado */
        .gauge-container {
            position: relative;
            width: 120px;
            height: 120px;
            background: #222;
            border-radius: 50%;
            border: 4px solid #444;
            box-shadow: 0 4px 0 #000;
        }
        .gauge-needle {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 50%;
            height: 4px;
            background: var(--duo-red);
            transform-origin: 0% 50%;
            transform: rotate(-90deg);
            transition: transform 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 2;
            border-radius: 2px;
        }
        .gauge-center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: #444;
            border-radius: 50%;
            z-index: 3;
        }

        /* Cores dos carros selecionáveis */
        .car-red path { fill: #ef4444; }
        .car-blue path { fill: #3b82f6; }
        .car-yellow path { fill: #eab308; }
        .car-green path { fill: #22c55e; }
        .car-purple path { fill: #a855f7; }

        /* Estilo da palavra alvo */
        .target-word-box {
            background: white;
            border: 2px solid #e5e5e5;
            border-bottom: 4px solid #e5e5e5;
            border-radius: 12px;
            color: #4b4b4b;
        }

    </style>
</head>
<body class="h-screen w-screen flex flex-col justify-center items-center relative text-white">

    <!-- TELA DE SELEÇÃO (INÍCIO) -->
    <div id="start-screen" class="absolute inset-0 z-50 bg-sky-400 flex flex-col items-center justify-center p-4">
        <div class="bg-white p-6 rounded-3xl shadow-2xl max-w-md w-full text-center border-b-8 border-gray-200">
            <h1 class="text-3xl font-black text-gray-700 mb-6 uppercase tracking-wider">DuoRacer</h1>
            
            <p class="text-gray-500 font-bold mb-2">Escolha seu Modelo:</p>
            <div class="flex justify-center gap-4 mb-6">
                <button onclick="selectModel(0)" class="model-btn p-2 rounded-xl border-2 border-transparent hover:bg-gray-100 transition" id="model-0">
                    <!-- SVG Car 1 -->
                    <div class="w-16 h-10 svg-container" data-model="0"></div>
                </button>
                <button onclick="selectModel(1)" class="model-btn p-2 rounded-xl border-2 border-transparent hover:bg-gray-100 transition" id="model-1">
                    <!-- SVG Car 2 -->
                    <div class="w-16 h-10 svg-container" data-model="1"></div>
                </button>
                <button onclick="selectModel(2)" class="model-btn p-2 rounded-xl border-2 border-transparent hover:bg-gray-100 transition" id="model-2">
                    <!-- SVG Car 3 -->
                    <div class="w-16 h-10 svg-container" data-model="2"></div>
                </button>
            </div>

            <p class="text-gray-500 font-bold mb-2">Escolha sua Cor:</p>
            <div class="flex justify-center gap-3 mb-8">
                <button onclick="selectColor('car-red')" class="w-10 h-10 rounded-full bg-red-500 border-b-4 border-red-700 transform active:translate-y-1 active:border-b-0"></button>
                <button onclick="selectColor('car-blue')" class="w-10 h-10 rounded-full bg-blue-500 border-b-4 border-blue-700 transform active:translate-y-1 active:border-b-0"></button>
                <button onclick="selectColor('car-yellow')" class="w-10 h-10 rounded-full bg-yellow-500 border-b-4 border-yellow-700 transform active:translate-y-1 active:border-b-0"></button>
                <button onclick="selectColor('car-green')" class="w-10 h-10 rounded-full bg-green-500 border-b-4 border-green-700 transform active:translate-y-1 active:border-b-0"></button>
                <button onclick="selectColor('car-purple')" class="w-10 h-10 rounded-full bg-purple-500 border-b-4 border-purple-700 transform active:translate-y-1 active:border-b-0"></button>
            </div>

            <button onclick="startGame()" class="w-full bg-[#58cc02] hover:bg-[#46a302] text-white font-black text-xl py-4 rounded-2xl border-b-4 border-[#46a302] active:border-b-0 active:translate-y-1 transition btn-flat shadow-lg">
                INICIAR CORRIDA
            </button>
        </div>
    </div>

    <!-- TELA DE GAME OVER -->
    <div id="game-over-screen" class="hidden absolute inset-0 z-50 bg-black/80 flex flex-col items-center justify-center p-4">
        <div class="bg-white p-8 rounded-3xl text-center max-w-sm w-full border-b-8 border-gray-300">
            <h2 class="text-4xl font-black text-[#ff4b4b] mb-2">FIM DE JOGO</h2>
            <p class="text-gray-500 text-lg font-bold mb-6">Pontuação Final: <span id="final-score" class="text-gray-800">0</span></p>
            <button onclick="location.reload()" class="w-full bg-[#1cb0f6] text-white font-black py-3 rounded-xl border-b-4 border-[#1899d6] active:border-b-0 active:translate-y-1 transition">
                TENTAR NOVAMENTE
            </button>
        </div>
    </div>

    <!-- CENÁRIO DO JOGO -->
    <div id="game-container" class="relative w-full h-full max-w-4xl max-h-[500px] overflow-hidden bg-sky-300 border-y-8 border-slate-800 shadow-2xl flex flex-col">
        
        <!-- Fundo Montanha (Parallax Lento) -->
        <div id="bg-mountains" class="absolute top-10 left-0 w-[200%] h-48 scrolling-bg opacity-80" 
             style="background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/e3/Mount_Fuji_from_Nihondaira_%2820120227%29.jpg'); background-size: contain; background-position: bottom;">
             <!-- Usando imagem representativa ou gradiente CSS se imagem falhar -->
             <div class="absolute inset-0 bg-gradient-to-t from-white/30 to-transparent"></div>
        </div>
        
        <!-- Área da Pista -->
        <div class="mt-auto h-64 relative w-full bg-[#555] flex flex-col border-t-4 border-green-700">
            <!-- Grama no horizonte -->
            <div class="h-4 w-full bg-[#76c639] border-b-4 border-[#5da526]"></div>

            <!-- Pista 0 (Topo) -->
            <div class="flex-1 border-b-2 border-dashed border-gray-400/50 relative lane" id="lane-0">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 px-3 py-1 rounded-lg font-bold text-gray-800 text-sm hidden answer-box transform transition-all">GATO</div>
            </div>
            
            <!-- Pista 1 (Meio) -->
            <div class="flex-1 border-b-2 border-dashed border-gray-400/50 relative lane" id="lane-1">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 px-3 py-1 rounded-lg font-bold text-gray-800 text-sm hidden answer-box transform transition-all">CACHORRO</div>
            </div>
            
            <!-- Pista 2 (Baixo) -->
            <div class="flex-1 relative lane" id="lane-2">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 px-3 py-1 rounded-lg font-bold text-gray-800 text-sm hidden answer-box transform transition-all">PÁSSARO</div>
            </div>

            <!-- Carro do Jogador -->
            <div id="player-car" class="absolute left-10 w-24 h-12 flex items-center justify-center transition-all duration-200 z-20">
                <!-- SVG injected via JS -->
            </div>

            <!-- Obstáculos e Carros Inimigos (gerados dinamicamente) -->
            <div id="objects-layer" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        </div>

        <!-- HUD: Placar e Palavra -->
        <div class="absolute top-4 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 w-full px-4">
             <div class="flex gap-4 items-center bg-black/40 backdrop-blur-sm px-4 py-1 rounded-full text-white font-mono font-bold">
                <span>SCORE: <span id="score-display">0</span></span>
                <span class="text-yellow-400">TIME: <span id="time-display">00.0</span></span>
            </div>
            
            <!-- Caixa da Palavra em Inglês -->
            <div id="word-box" class="target-word-box px-8 py-3 text-2xl font-black shadow-lg transform scale-0 transition-transform duration-300">
                Waiting...
            </div>
        </div>

    </div>

    <!-- CONTROLES E PAINEL (Abaixo do jogo) -->
    <div class="w-full max-w-4xl bg-gray-900 p-4 flex justify-between items-center gap-4 border-t-4 border-gray-700">
        
        <!-- Botões de Pista (Esquerda) -->
        <div class="flex flex-col gap-2">
            <button id="btn-up" class="w-20 h-20 bg-gray-700 hover:bg-gray-600 rounded-xl border-b-8 border-gray-800 active:border-b-0 active:translate-y-2 transition flex items-center justify-center">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 15l7-7 7 7"></path></svg>
            </button>
            <button id="btn-down" class="w-20 h-20 bg-gray-700 hover:bg-gray-600 rounded-xl border-b-8 border-gray-800 active:border-b-0 active:translate-y-2 transition flex items-center justify-center">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
            </button>
        </div>

        <!-- Painel Central (Velocímetro e Marcha) -->
        <div class="flex items-center gap-6">
            <div class="gauge-container relative hidden sm:block">
                <div class="gauge-center"></div>
                <div id="rpm-needle" class="gauge-needle"></div>
                <div class="absolute bottom-6 left-1/2 -translate-x-1/2 text-white font-mono font-bold text-sm">RPM</div>
            </div>
            
            <div class="flex flex-col items-center">
                <div class="gauge-container relative">
                    <div class="gauge-center"></div>
                    <div id="speed-needle" class="gauge-needle" style="background: white;"></div>
                    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 text-white font-mono font-black text-xl"><span id="speed-val">0</span></div>
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-gray-400 text-xs font-bold">MPH</div>
                </div>
                <div class="mt-2 bg-black px-4 py-1 rounded text-green-500 font-mono font-bold border border-gray-700">
                    GEAR <span id="gear-val" class="text-xl text-white">N</span>
                </div>
            </div>
        </div>

        <!-- Botões de Marcha (Direita) -->
        <div class="flex gap-2 items-center">
            <button id="btn-gear-down" class="w-16 h-20 bg-red-500 hover:bg-red-400 rounded-xl border-b-8 border-red-700 active:border-b-0 active:translate-y-2 transition flex items-center justify-center">
                <span class="text-3xl font-black text-white/90">-</span>
            </button>
            <button id="btn-gear-up" class="w-16 h-20 bg-green-500 hover:bg-green-400 rounded-xl border-b-8 border-green-700 active:border-b-0 active:translate-y-2 transition flex items-center justify-center">
                <span class="text-3xl font-black text-white/90">+</span>
            </button>
        </div>

    </div>

    <!-- AUDIO ELEMENTS (Opcional, placeholders) -->
    <!-- Logica será apenas visual por enquanto para manter um único arquivo robusto -->

    <script>
        // --- DADOS DO JOGO ---
        const CAR_SVGS = [
            // Carro 1 (Esportivo)
            `<svg class="w-full h-full" fill="currentColor" viewBox="0 -43.92 122.88 122.88"><path d="M99.42,13.57c5.93,0,10.73,4.8,10.73,10.73c0,5.93-4.8,10.73-10.73,10.73s-10.73-4.8-10.73-10.73 C88.69,18.37,93.49,13.57,99.42,13.57L99.42,13.57z M79.05,5c-0.59,1.27-1.06,2.69-1.42,4.23c-0.82,2.57,0.39,3.11,3.19,2.06 c2.06-1.23,4.12-2.47,6.18-3.7c1.05-0.74,1.55-1.47,1.38-2.19c-0.34-1.42-3.08-2.16-5.33-2.6C80.19,2.23,80.39,2.11,79.05,5 L79.05,5z M23.86,19.31c2.75,0,4.99,2.23,4.99,4.99c0,2.75-2.23,4.99-4.99,4.99c-2.75,0-4.99-2.23-4.99-4.99 C18.87,21.54,21.1,19.31,23.86,19.31L23.86,19.31z M99.42,19.31c2.75,0,4.99,2.23,4.99,4.99c0,2.75-2.23,4.99-4.99,4.99 c-2.75,0-4.99-2.23-4.99-4.99C94.43,21.54,96.66,19.31,99.42,19.31L99.42,19.31z M46.14,12.5c2.77-2.97,5.97-4.9,9.67-6.76 c8.1-4.08,13.06-3.58,21.66-3.58l-2.89,7.5c-1.21,1.6-2.58,2.73-4.66,2.84H46.14L46.14,12.5z M23.86,13.57 c5.93,0,10.73,4.8,10.73,10.73c0,5.93-4.8,10.73-10.73,10.73s-10.73-4.8-10.73-10.73C13.13,18.37,17.93,13.57,23.86,13.57 L23.86,13.57z M40.82,10.3c3.52-2.19,7.35-4.15,11.59-5.82c12.91-5.09,22.78-6,36.32-1.9c4.08,1.55,8.16,3.1,12.24,4.06 c4.03,0.96,21.48,1.88,21.91,4.81l-4.31,5.15c1.57,1.36,2.85,3.03,3.32,5.64c-0.13,1.61-0.57,2.96-1.33,4.04 c-1.29,1.85-5.07,3.76-7.11,2.67c-0.65-0.35-1.02-1.05-1.01-2.24c0.06-23.9-28.79-21.18-26.62,2.82H35.48 C44.8,5.49,5.04,5.4,12.1,28.7C9.62,31.38,3.77,27.34,0,18.75c1.03-1.02,2.16-1.99,3.42-2.89c-0.06-0.05,0.06,0.19-0.15-0.17 c-0.21-0.36,0.51-1.87,1.99-2.74C13.02,8.4,31.73,8.52,40.82,10.3L40.82,10.3z"/></svg>`,
            // Carro 2 (Sedan)
            `<svg class="w-full h-full" fill="currentColor" viewBox="0 -43.14 122.88 122.88"><path d="M0,23.97c0.29-1.63,1.11-2.63,2.72-2.69c-0.14-1.7,0.18-3.13,0.92-4.31c0.35-0.55,0.79-1.04,1.33-1.47 c1.87-1.52,3.99-1.68,6.3-2.1c2.24-0.41,4.48-0.75,6.71-1.01c2.7-0.32,5.41-0.53,8.12-0.61c1.25-0.04,0.95,0.03,1.95-0.73 c4.87-3.76,10.17-6.85,15.72-9.52C45.7,0.55,48.18,0.08,51.09,0C56.91,0,80,0,85.82,0c3.85,0.02,7.13,0.9,9.88,2.56l10.58,8.14 c3.53,0.23,7.05,0.46,10.58,0.7c2.16-0.06,3.81,0.68,4.44,3.02v7.15c2.99,0.77,1.04,7.66-0.3,9.17c-1.18,1.33-2.26,1.18-3.84,1.18 h-9.43c1.81-13.63-12.08-16.54-17.8-9.12c-1.89,2.45-2.18,5.79-1.39,9.72H28.45c2.19-10.1-4.33-14.21-10.33-13.62 c-7.72,0.76-9.75,6.95-8.42,13.74H3.01C1.11,32.72,0.22,31.2,0,28.63V23.97L0,23.97z M20.04,25.27v2.76h2.76 C22.47,26.68,21.4,25.61,20.04,25.27L20.04,25.27z M22.8,29.83h-2.76v2.76C21.4,32.26,22.47,31.19,22.8,29.83L22.8,29.83z M19.15,32.7h-0.02h0.01H19.15L19.15,32.7z M18.24,32.59v-2.76h-2.76C15.81,31.19,16.88,32.26,18.24,32.59L18.24,32.59z M15.48,28.03h2.76v-2.76C16.88,25.61,15.81,26.67,15.48,28.03L15.48,28.03z M98.8,25.27v2.76h2.76 C101.23,26.68,100.16,25.61,98.8,25.27L98.8,25.27z M101.67,28.92v0.02l0-0.01L101.67,28.92L101.67,28.92z M101.57,29.83H98.8v2.76 C100.16,32.26,101.23,31.19,101.57,29.83L101.57,29.83z M97.92,32.7h-0.02h0.01H97.92L97.92,32.7z M97.01,32.59v-2.76h-2.76 C94.58,31.19,95.65,32.26,97.01,32.59L97.01,32.59z M94.24,28.03h2.76v-2.76C95.65,25.61,94.58,26.67,94.24,28.03L94.24,28.03z M33.07,10.7V14h20.09l1.56-11.48h-4.58c-3.65,0.43-4.24,0.55-7.55,2.31c-2.73,1.45-5.22,3.04-7.87,4.77 C34.17,9.96,33.61,10.33,33.07,10.7L33.07,10.7z M77.54,2.39l-1.73,11.62h11.53l2.37-2.57L91,10.04c-0.12-6.79-0.93-7.55-6.95-7.58 L77.54,2.39L77.54,2.39z M58.08,2.39l-1.73,11.62h15.37l1.52-11.53L58.08,2.39L58.08,2.39z M19.14,21.27 c4.23,0,7.67,3.43,7.67,7.67c0,4.23-3.43,7.67-7.67,7.67c-4.23,0-7.67-3.43-7.67-7.67C11.47,24.7,14.9,21.27,19.14,21.27 L19.14,21.27z M97.9,21.27c4.23,0,7.67,3.43,7.67,7.67c0,4.23-3.43,7.67-7.67,7.67c-4.23,0-7.67-3.43-7.67-7.67 C90.24,24.7,93.67,21.27,97.9,21.27L97.9,21.27z"/></svg>`,
            // Carro 3 (Truck/SUV)
            `<svg class="w-full h-full" fill="currentColor" viewBox="0 -30.88 122.88 122.88"><path d="M65.22,0h26.54h6.63c0.38,0,0.52,0.34,0.68,0.68l2.66,5.53c0.16,0.34-0.31,0.68-0.68,0.68H55.93 C52.98,6.9,58.02,0,65.22,0L65.22,0z M23.83,45.74v3.74h3.74C27.12,47.65,25.67,46.19,23.83,45.74L23.83,45.74z M27.57,51.93h-3.74 v3.74C25.67,55.22,27.12,53.77,27.57,51.93L27.57,51.93z M21.39,55.67v-3.74h-3.74C18.1,53.77,19.55,55.22,21.39,55.67L21.39,55.67 z M17.64,49.49h3.74v-3.74C19.55,46.2,18.1,47.65,17.64,49.49L17.64,49.49z M90.05,45.74v3.74h3.74 C93.34,47.65,91.89,46.19,90.05,45.74L90.05,45.74z M93.79,51.93h-3.74v3.74C91.89,55.22,93.34,53.77,93.79,51.93L93.79,51.93z M87.61,55.67v-3.74h-3.74C84.31,53.77,85.76,55.22,87.61,55.67L87.61,55.67z M83.86,49.49h3.74v-3.74 C85.76,46.2,84.31,47.65,83.86,49.49L83.86,49.49z M89.66,12.77h3.52c5.08,0.23,7.17,0.05,9.19,1.59 c2.5,1.91,3.48,10.35,4.52,14.25c0.07,0.26-0.23,0.5-0.5,0.5H90.88c-0.27,0-0.47-0.22-0.5-0.5l-1.22-15.35 C89.14,13,89.39,12.77,89.66,12.77L89.66,12.77z M66.09,12.86h-11.5c-5.25,0-13.89,8.63-16.15,15.61 c-0.11,0.34,0.29,0.65,0.65,0.65h25.18c0.36,0,0.6-0.29,0.65-0.65l1.83-14.96C66.78,13.15,66.44,12.86,66.09,12.86L66.09,12.86z M71.07,12.8h14.07c0.27,0,0.48,0.23,0.5,0.5l1.07,15.32c0.02,0.27-0.23,0.5-0.5,0.5H69.24c-0.27,0-0.53-0.23-0.5-0.5l1.83-15.32 C70.6,13.02,70.79,12.8,71.07,12.8L71.07,12.8z M22.61,40.31c5.74,0,10.4,4.66,10.4,10.4c0,5.74-4.66,10.4-10.4,10.4 c-5.74,0-10.4-4.66-10.4-10.4C12.21,44.97,16.87,40.31,22.61,40.31L22.61,40.31z M1.81,40.78c0.53-0.24,1.11-0.35,1.74-0.34 c-0.03-3.28,0.19-6.14,0.95-8.17c0.28-1.17,0.79-2.02,1.47-2.64c2.14-1.91,21.25-3.59,25.28-4.11c4.95-4.84,10.46-9.27,16.33-13.46 c1.63-1.38,3.96-2.06,6.9-2.13l46.41-0.04c3.51-0.02,6.21,1.48,7.93,4.85l3.87,11.15l0.88-0.24v-4.34 c-0.16-1.45,0.41-2.17,1.52-2.35h5.2c1.43,0.06,2.44,0.78,2.6,2.85v15.42c0.01,1.59-0.57,2.63-2.04,2.85h-4.83 c-0.48,0.11-0.33,0.48-0.37,0.99v5.26c-0.35,3.88-1.41,6.88-4.52,7.27h-9.41c0.2-4.56-0.66-8.29-2.75-11.08 c-7.59-10.14-24.06-4.1-22.95,11.11H35.58c0.34-4.86-0.58-8.55-2.59-11.2c-7.57-9.99-25.18-4.6-23.1,11.51H3.64 C-0.13,53.94-1.36,42.19,1.81,40.78L1.81,40.78z M88.83,40.31c5.74,0,10.4,4.66,10.4,10.4c0,5.74-4.66,10.4-10.4,10.4 c-5.74,0-10.4-4.66-10.4-10.4C78.43,44.97,83.08,40.31,88.83,40.31L88.83,40.31z"/></svg>`
        ];

        const DICTIONARY = [
            { en: "Cat", pt: "Gato", wrong: ["Pássaro", "Cão", "Peixe", "Casa"] },
            { en: "Red", pt: "Vermelho", wrong: ["Azul", "Verde", "Amarelo", "Preto"] },
            { en: "Water", pt: "Água", wrong: ["Fogo", "Terra", "Ar", "Pedra"] },
            { en: "Book", pt: "Livro", wrong: ["Caneta", "Mesa", "Lápis", "Papel"] },
            { en: "House", pt: "Casa", wrong: ["Carro", "Rua", "Cidade", "Prédio"] },
            { en: "Man", pt: "Homem", wrong: ["Mulher", "Menino", "Menina", "Pessoa"] },
            { en: "Apple", pt: "Maçã", wrong: ["Banana", "Uva", "Pera", "Fruta"] },
            { en: "Sun", pt: "Sol", wrong: ["Lua", "Estrela", "Céu", "Nuvem"] },
            { en: "Milk", pt: "Leite", wrong: ["Café", "Chá", "Suco", "Água"] },
            { en: "Bread", pt: "Pão", wrong: ["Queijo", "Carne", "Ovo", "Bolo"] }
        ];

        // --- VARIÁVEIS DE ESTADO ---
        let state = {
            screen: 'START', // START, GAME, GAMEOVER
            selectedCar: 0,
            selectedColor: 'car-red',
            score: 0,
            gear: 1, // 1-5
            speed: 0, // 0-160
            targetSpeed: 0,
            lane: 1, // 0 (Top), 1 (Mid), 2 (Bot)
            questionActive: false,
            questionTimer: 0,
            currentWord: null,
            correctLane: -1,
            distance: 0,
            lastFrame: 0,
            nextQuestionDist: 1000,
        };

        const MAX_SPEED_PER_GEAR = [0, 40, 80, 110, 140, 160];
        const ACCEL_RATE = 0.5;
        const DECEL_RATE = 0.2;
        const LANE_HEIGHT = 80; // pixels aprox

        // Elementos DOM cacheados
        const els = {
            player: document.getElementById('player-car'),
            lanes: [
                document.getElementById('lane-0'),
                document.getElementById('lane-1'),
                document.getElementById('lane-2')
            ],
            bg: document.getElementById('bg-mountains'),
            score: document.getElementById('score-display'),
            time: document.getElementById('time-display'),
            speed: document.getElementById('speed-val'),
            gear: document.getElementById('gear-val'),
            wordBox: document.getElementById('word-box'),
            needleSpeed: document.getElementById('speed-needle'),
            needleRpm: document.getElementById('rpm-needle'),
            objectsLayer: document.getElementById('objects-layer'),
            answerBoxes: document.querySelectorAll('.answer-box')
        };

        // --- SETUP INICIAL ---
        
        function init() {
            // Renderizar SVGs na seleção
            document.querySelectorAll('.svg-container').forEach(el => {
                const model = el.getAttribute('data-model');
                el.innerHTML = CAR_SVGS[model];
            });

            // Listeners de Teclado
            window.addEventListener('keydown', handleInput);
            
            // Listeners de Botão
            document.getElementById('btn-up').addEventListener('touchstart', (e) => { e.preventDefault(); changeLane(-1); });
            document.getElementById('btn-up').addEventListener('mousedown', () => changeLane(-1));
            
            document.getElementById('btn-down').addEventListener('touchstart', (e) => { e.preventDefault(); changeLane(1); });
            document.getElementById('btn-down').addEventListener('mousedown', () => changeLane(1));

            document.getElementById('btn-gear-up').addEventListener('touchstart', (e) => { e.preventDefault(); shiftGear(1); });
            document.getElementById('btn-gear-up').addEventListener('mousedown', () => shiftGear(1));

            document.getElementById('btn-gear-down').addEventListener('touchstart', (e) => { e.preventDefault(); shiftGear(-1); });
            document.getElementById('btn-gear-down').addEventListener('mousedown', () => shiftGear(-1));

            // Game Loop
            requestAnimationFrame(gameLoop);
        }

        // --- LÓGICA DE SELEÇÃO ---

        window.selectModel = (index) => {
            state.selectedCar = index;
            document.querySelectorAll('.model-btn').forEach((btn, i) => {
                if(i === index) btn.classList.add('bg-blue-100', 'border-blue-400');
                else btn.classList.remove('bg-blue-100', 'border-blue-400');
            });
        }

        window.selectColor = (colorClass) => {
            state.selectedColor = colorClass;
            // Visual feedback could be added here
        }

        window.startGame = () => {
            document.getElementById('start-screen').classList.add('hidden');
            state.screen = 'GAME';
            
            // Configurar carro do jogador
            els.player.innerHTML = CAR_SVGS[state.selectedCar];
            els.player.className = `absolute left-10 w-24 h-12 flex items-center justify-center transition-all duration-200 z-20 ${state.selectedColor}`;
            
            resetGame();
        }

        function resetGame() {
            state.score = 0;
            state.gear = 1; // Start in Neutral/1st
            state.speed = 0;
            state.lane = 1;
            state.distance = 0;
            state.nextQuestionDist = 200;
            state.questionActive = false;
            els.objectsLayer.innerHTML = ''; // Limpar obstáculos
            updatePlayerPos();
        }

        // --- LÓGICA DO JOGO ---

        function handleInput(e) {
            if (state.screen !== 'GAME') return;
            
            if (e.key === 'ArrowUp') changeLane(-1);
            if (e.key === 'ArrowDown') changeLane(1);
            if (e.key === 'ArrowRight') shiftGear(1);
            if (e.key === 'ArrowLeft') shiftGear(-1);
        }

        function changeLane(dir) {
            const newLane = state.lane + dir;
            if (newLane >= 0 && newLane <= 2) {
                state.lane = newLane;
                updatePlayerPos();
            }
        }

        function shiftGear(dir) {
            const newGear = state.gear + dir;
            if (newGear >= 1 && newGear <= 5) {
                state.gear = newGear;
                els.gear.innerText = state.gear;
            }
        }

        function updatePlayerPos() {
            // Lane 0: top 10%, Lane 1: top 40%, Lane 2: top 70% (relative to container logic)
            // Mas estamos usando flex no CSS. Vamos usar top absolute.
            const laneOffsets = [16, 80, 144]; // Pixels from top of road container
            els.player.style.top = `${laneOffsets[state.lane]}px`;
        }

        function spawnQuestion() {
            state.questionActive = true;
            state.questionTimer = 10.0 - (state.gear); // Menos tempo em marchas altas
            
            // Escolher palavra
            const wordObj = DICTIONARY[Math.floor(Math.random() * DICTIONARY.length)];
            state.currentWord = wordObj;
            
            // Definir pista correta
            state.correctLane = Math.floor(Math.random() * 3);
            
            // Popular pistas
            const wrongOptions = [...wordObj.wrong].sort(() => 0.5 - Math.random()).slice(0, 2);
            let wrongIdx = 0;
            
            els.wordBox.innerText = wordObj.en;
            els.wordBox.classList.remove('scale-0');
            
            els.answerBoxes.forEach((box, idx) => {
                box.classList.remove('hidden');
                if (idx === state.correctLane) {
                    box.innerText = wordObj.pt;
                    box.dataset.correct = "true";
                } else {
                    box.innerText = wrongOptions[wrongIdx];
                    box.dataset.correct = "false";
                    wrongIdx++;
                }
            });
        }

        function resolveQuestion(success) {
            state.questionActive = false;
            els.wordBox.classList.add('scale-0');
            els.answerBoxes.forEach(box => box.classList.add('hidden'));

            if (success) {
                state.score += 100 * state.gear;
                // Efeito sonoro de acerto
                showFeedback("CORRECT!", "text-green-500");
                // Carros ultrapassados visualmente (spawn dummy car moving left)
                spawnPassingCar();
            } else {
                state.speed = 20; // Penalidade brusca
                state.gear = 1;
                els.gear.innerText = "1";
                showFeedback("OUCH!", "text-red-500");
                spawnObstacles(); // Gera buracos nas pistas erradas visualmente
            }
            
            state.nextQuestionDist = state.distance + 1500;
        }

        function spawnPassingCar() {
            // Cria um carro que passa "para trás" (simulando ultrapassagem)
            const car = document.createElement('div');
            // Escolhe pista aleatoria diferente da atual
            let lane = Math.floor(Math.random() * 3);
            while(lane === state.lane) lane = Math.floor(Math.random() * 3);
            
            const laneOffsets = [16, 80, 144];
            
            car.className = "absolute w-24 h-12 flex items-center justify-center transition-none z-10 text-gray-400";
            car.style.top = `${laneOffsets[lane]}px`;
            car.style.left = '100%';
            car.innerHTML = CAR_SVGS[Math.floor(Math.random()*3)];
            
            els.objectsLayer.appendChild(car);

            // Animar
            let pos = 100;
            const anim = setInterval(() => {
                pos -= 2 + (state.speed / 20); // Move left based on speed
                car.style.left = pos + '%';
                if (pos < -20) {
                    clearInterval(anim);
                    car.remove();
                }
            }, 16);
        }

        function spawnObstacles() {
            // Cria "Buracos" nas pistas
            // Se o jogador errou, ele bateu em um.
            // Vamos simular visualmente um buraco passando rápido
             const hole = document.createElement('div');
             const laneOffsets = [30, 94, 158]; // Ajustado para centro da pista
             
             hole.className = "absolute w-12 h-6 obstacle z-10";
             hole.style.top = `${laneOffsets[state.lane]}px`;
             hole.style.left = '10%'; // Já passou, está embaixo do carro
             
             els.objectsLayer.appendChild(hole);
             
             // Move o buraco para trás
             let pos = 10;
             const anim = setInterval(() => {
                pos -= 2;
                hole.style.left = pos + '%';
                if (pos < -10) {
                    clearInterval(anim);
                    hole.remove();
                }
             }, 16);
        }

        function showFeedback(text, colorClass) {
            const fb = document.createElement('div');
            fb.className = `absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl font-black ${colorClass} z-50 animate-bounce`;
            fb.innerText = text;
            els.objectsLayer.appendChild(fb);
            setTimeout(() => fb.remove(), 1000);
        }

        // --- GAME LOOP PRINCIPAL ---

        function gameLoop(timestamp) {
            if (!state.lastFrame) state.lastFrame = timestamp;
            const dt = (timestamp - state.lastFrame) / 1000;
            state.lastFrame = timestamp;

            if (state.screen === 'GAME') {
                // Física de Velocidade
                state.targetSpeed = MAX_SPEED_PER_GEAR[state.gear];
                
                if (state.speed < state.targetSpeed) {
                    state.speed += ACCEL_RATE;
                } else if (state.speed > state.targetSpeed) {
                    state.speed -= DECEL_RATE;
                }

                state.distance += state.speed * dt;

                // Atualizar HUD
                els.score.innerText = Math.floor(state.score);
                els.speed.innerText = Math.floor(state.speed);
                
                // Agulhas
                const rotSpeed = -90 + (state.speed / 160) * 180;
                els.needleSpeed.style.transform = `rotate(${rotSpeed}deg)`;
                
                // Simula RPM (sobe com velocidade, cai na troca de marcha)
                // Simplificação: RPM segue % da velocidade da marcha atual
                const gearMin = MAX_SPEED_PER_GEAR[state.gear-1] || 0;
                const gearRange = MAX_SPEED_PER_GEAR[state.gear] - gearMin;
                const speedInGear = state.speed - gearMin;
                let rpmPct = Math.max(0, speedInGear / gearRange);
                if(rpmPct > 1) rpmPct = 0.8 + (Math.random() * 0.1); // Flutua no limite
                const rotRpm = -90 + (rpmPct * 180);
                els.needleRpm.style.transform = `rotate(${rotRpm}deg)`;

                // Movimento do Fundo (Simula velocidade)
                // bg-position-x
                const bgPos = (state.distance * 0.5) % 1000;
                els.bg.style.backgroundPosition = `-${bgPos}px bottom`;
                
                // Pista (efeito de movimento nas linhas tracejadas)
                els.lanes.forEach(l => {
                    l.style.backgroundPosition = `-${state.distance * 2}px 0`;
                });

                // Lógica de Perguntas
                if (!state.questionActive) {
                    if (state.distance > state.nextQuestionDist) {
                        spawnQuestion();
                    }
                } else {
                    // Timer regressivo
                    state.questionTimer -= dt;
                    els.time.innerText = state.questionTimer.toFixed(1);

                    if (state.questionTimer <= 0) {
                        // Tempo acabou, verificar pista
                        if (state.lane === state.correctLane) {
                            resolveQuestion(true);
                        } else {
                            resolveQuestion(false);
                        }
                    }
                }
            }

            requestAnimationFrame(gameLoop);
        }

        // Inicializar
        init();

    </script>
</body>
</html>